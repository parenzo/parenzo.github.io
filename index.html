<html>
<head>
<title>Crux Soundboard</title>
<body onload="createMainBoard()">
<style>

h2 {
	font-family: "Verdana", Geneva, sans-serif;
}

h3 {
	font-family: "Verdana", Geneva, sans-serif;
}

.grid-header {
   display: inline-grid;
   grid-gap: 10px 10px;
   grid-template-columns: 17% 18% 16% 12% 12% 12%;
   width: 100vw;  
}

.grid-container {
   display: inline-grid;
   grid-gap: 10px 10px;
   grid-template-columns: 30% 30% 30%; 
   width: 100vw;  
}

button {	
   	font-size: 20pt;
   	font-family: "Verdana", Geneva, sans-serif;
	min-height: 60px;
}

.playingButton {
	background: linear-gradient(to right, rgb(52, 235, 146) 100%, white 0%);
}

.jingleButton {
	background-color: white; 
	border: 2px solid #008CBA;
}

.cruxButton {
	border: 2px solid black;
}

.btnStop {
   	color: rgb(245, 66, 114);
	grid-row-gap: 1ch;
}

.btnAll {
   	color: rgb(69, 66, 245);
	grid-row-gap: 1ch;
}

.footer {
	padding-top: 30px;
	text-align: center;
	font-size: 10pt;
   	font-family: "Verdana", Geneva, sans-serif;
}

</style>
<script>

	class Sound {
		constructor(resource, description, tags) {			
			this.resource = resource;
			this.description = description;
			this.tags = tags;
		}		
	}
	
	function MakeAudioElementId(sound) {
		return "audio_" + sound.resource;
	}

	function MakeButtonElementId(sound) {
		return "btn_" + sound.resource;
	}

	function MakeAudioElement(sound) {
		var audioElement = document.createElement('audio');		
		var id = MakeAudioElementId(sound);		
		audioElement.setAttribute('id', id);
		audioElement.setAttribute('src', sound.resource);
		audioElement.setAttribute('class', 'grid-item');	
		document.body.appendChild(audioElement);
		return audioElement;
	}

	function ButtonClass(sound) {
		if (sound.tags.includes("jingle")){		
			return "jingleButton";
		}
		return "cruxButton";
	}

	function MakeButtonElement(sound) {
		var buttonElement = document.createElement('button');	
		buttonElement.setAttribute('id', MakeButtonElementId(sound));	
		buttonElement.innerHTML = sound.description.replace(/-/g, ' ');
		buttonElement.className = ButtonClass(sound);
		return buttonElement;
	}

	class BoardSound {
		constructor(sound, onClick, onAudioEnded) {
			this.sound = sound;
			this.audio = MakeAudioElement(sound);
			this.button = MakeButtonElement(sound);

			this.audio.onended = this.audio.onpause = () => { 
				this.button.className = ButtonClass(sound);
				onAudioEnded(this.sound, this.audio);
			};

			this.audio.onplay = () => {
				this.button.className = "playingButton";
			};			

			this.button.onclick = onClick;			
		}

		AppendTo(control) {
			control.appendChild(this.button);
		}
		
		Trigger() {
			if (this.audio.paused) {
				this.Play();
			}
			else {
				this.Stop();
			}
		}

		Play() {
			this.audio.play();
		}

		Stop() {
			this.audio.pause();
			this.audio.currentTime = 0;
		}
	}

	class SoundsRepository {
		constructor(sounds) {
			this.data = {};
			this.onAudioEnded = {};

			sounds.forEach( sound => {
				var boardSound = new BoardSound(
					sound, 
					() => { this.Trigger(sound.resource); }, 
					(s, a) => { 
						for (var f in this.onAudioEnded){
							this.onAudioEnded[f](s, a);
						}
					 }
				);
				this.data[sound.resource] = boardSound;			
			});
		}

		SubscribeToAudioEnded(id, f) {
			this.onAudioEnded[id] = f;
		}

		UbsubscribeToAudioEnded(id) {
			delete this.onAudioEnded[id];
		}

		OnSound(soundId, f) {
			if (this.data[soundId] != null) {				
				f(this.data[soundId]);
			}		
		}

		StopAll() {
			for (var i in this.data) {
				this.data[i].Stop();
			}
		}

		ForEach(f) {
			for (var i in this.data) {
				f(this.data[i].sound, this.data[i].audio, this.data[i].button);
			}
		}

		Trigger(soundId) {
			if (this.data[soundId] != null) {				
				this.data[soundId].Trigger();
			}
		}

		Play(soundId) {
			if (this.data[soundId] != null) {				
				this.data[soundId].Play();
			}
		}
	}	

	class Board {
		constructor(control, repo) {
			this.control = control;
			this.soundsRepository = repo;
			this.sounds = [];

			this.Clear();
		}
		
		Add(sounds) {
			sounds.forEach(sound => {
				this.sounds.push(sound.resource);

				this.soundsRepository.OnSound(sound.resource, (boardSound) => {
					boardSound.AppendTo(this.control);
				});
			});		
		}

		Replace(sounds) {
			this.sounds = [];		
			this.Clear();
			this.Add(sounds);
		}

		Clear() {
			this.sounds = [];
			while (this.control.firstChild) {
    			this.control.removeChild(this.control.firstChild);
			}
		}

		AvailableSounds() {
			return this.sounds;
		}
	}

	function createMainBoard() {

		MainSounds = [		
			// crux
			new Sound("crux/aggiusta-il-mic.mp3", "aggiusta il microfono", ["crux", "microfono"]),
			new Sound("crux/amica-mia.mp3", "amica mia", ["crux"]),
			new Sound("crux/andiamo-con-ordine.mp3", "andiamo con ordine", ["crux"]),
			new Sound("crux/appassionato-di-odori.mp3", "appassionato di odori", ["crux"]),
			new Sound("crux/arrivederci-grazie.mp3", "arrivederci, grazie", ["crux"]),
			new Sound("crux/beh-amico-mio.mp3", "beh amico mio", ["crux"]),
			new Sound("crux/breaking-news.mp3", "breaking news", ["crux"]),
			new Sound("crux/che-testa-di-cazzo.mp3", "che testa di cazzo", ["crux"]),
			new Sound("crux/chi-sei.mp3", "chi sei?", ["crux"]),
			new Sound("crux/ciao-ciao.mp3", "ciao ciao", ["crux"]),
			new Sound("crux/come-ti-chiami.mp3", "come ti chiami?", ["crux"]),
			new Sound("crux/fermi-tutti.mp3", "fermi tutti", ["crux"]),	
			new Sound("crux/fermi-tutti-x2.mp3", "fermi tutti (x2)", ["crux"]),
			new Sound("crux/giu-questo-infame.mp3", "gi√π questo infame", ["crux"]),
			new Sound("crux/glory-hole.mp3", "glory hole", ["crux"]),
			new Sound("crux/hanno-ridato-il-telefono-al-demone.mp3", "hanno ridato il telefono al demone", ["crux"]),
			new Sound("crux/italiani.mp3", "italiani", ["crux"]),
			new Sound("crux/la-cosa-sessuale-pi√π-incredibile.mp3", "la cosa sessuale pi√π incredibile", ["crux"]),
			new Sound("crux/lei-non-sa-squirting.mp3", "lei non sa cos'√® lo squirting?", ["crux"]),
			new Sound("crux/ma-sti-cazzi.mp3", "ma sti cazzi", ["crux"]),
			new Sound("crux/mai-piaciuta-la-patata.mp3", "mai piaciuta la patata?", ["crux"]),
			new Sound("crux/mhai-rotto-i-coglioni-ciao.mp3", "m'hai rotto i coglioni ciao", ["crux"]),
			new Sound("crux/monografia-sullo-squirting.mp3", "monografia sullo squirting", ["crux"]),
			new Sound("crux/non-me-ne-frega-niente.mp3", "non me ne frega niente", ["crux"]),
			new Sound("crux/non-sento-imbecille.mp3", "non sento, imbecille", ["crux"]),
			new Sound("crux/parentesi-inutili.mp3", "parentesi inutili", ["crux"]),
			new Sound("crux/per-caso-tu-squirti.mp3", "per caso tu squirti?", ["crux"]),
			new Sound("crux/perch√©-non-chiami-bene.mp3", "perch√® non chiami bene?", ["crux"]),
			new Sound("crux/puttanata.mp3", "puttanata", ["crux"]),		
			new Sound("crux/qualcosa-di-grave.mp3", "qualcosa di grave", ["crux"]),
			new Sound("crux/questo-√®-buono.mp3", "questo √® buono", ["crux"]),
			new Sound("crux/se-non-lhai-capito.mp3", "se non l'hai capito", ["crux"]),
			new Sound("crux/signora-aurora.mp3", "signora aurora lei squirta?", ["crux"]),
			new Sound("crux/sono-cruciani.mp3", "sono cruciani", ["crux"]),
			new Sound("crux/sono-un-puttaniere.mp3", "sono un puttaniere", ["crux"]),
			new Sound("crux/spiegami-bene.mp3", "spiegami bene", ["crux"]),
			new Sound("crux/stai-zitto-nattimo.mp3", "stai zitto n'attimo", ["crux"]),
			new Sound("crux/togli-il-vivavoce.mp3", "togli il vivavoce", ["crux"]),
			new Sound("crux/top-assoluto.mp3", "top assoluto", ["crux"]),
			new Sound("crux/vado-ai-pazzi.mp3", "vado ai pazzi", ["crux"]),
			new Sound("crux/via-via.mp3", "via via", ["crux"]),

			// extras
			new Sound("crux/EXTRA-il-signor-giancarlo.mp3", "(extra) il signor giancarlo", ["extra"]),
			new Sound("crux/EXTRA-fede-figura-di-merda.mp3", "(extra) che figura di merda", ["extra"]),

			// jingles
			new Sound("jingle/a-tutto-foho.mp3", "a tutto foho", ["jingle"]),
			new Sound("jingle/amor.mp3", "amor", ["jingle", "pappalardo"]),
			new Sound("jingle/daje-brasiless.mp3", "daje brasiless", ["jingle", "brasile"]),
			new Sound("jingle/david-sta-andando-a-trans.mp3", "david sta andando a trans", ["jingle", "parenzo"]),
			new Sound("jingle/facciamo-un-delirio.mp3", "facciamo un delirio", ["jingle", "richard benson"]),
			new Sound("jingle/fede.mp3", "sfogo di fede", ["jingle"]),
			new Sound("jingle/feltri-non-me-ne-frega-niente.mp3", "feltri: non me ne frega niente", ["jingle", "feltri"]),
			new Sound("jingle/fenomeno.mp3", "fenomeno", ["jingle"]),
			new Sound("jingle/i-love-to-listen-to-la-zanzara.mp3", "I love to listen to la zanzara", ["jingle"]),
			new Sound("jingle/ibbrido-uccello-di-Hitchcock.mp3", "ibbrido uccello di Hitchcock", ["jingle"]),
			new Sound("jingle/la-mia-specialit√†-√®-lo-squirting.mp3", "la mia specialit√† √® lo squirting", ["jingle"]),
			new Sound("jingle/le-mutandine-di-valentina-nappi.mp3", "le mutandine di valentina nappi", ["jingle"]),
			new Sound("jingle/ma-√®-una-roba-pazzesca.mp3", "ma √® una roba pazzesca", ["jingle"]),
			new Sound("jingle/mio-nipote.mp3", "mio nipote", ["jingle"]),
			new Sound("jingle/pamplona.mp3", "pamplona", ["jingle"]),
			new Sound("jingle/parenzo.mp3", "parenzo", ["jingle", "parenzo"]),
			new Sound("jingle/parenzo-mio-maestro.mp3", "parenzo mio maestro", ["jingle", "parenzo"]),
			new Sound("jingle/sgarbi-vs-mughini.mp3", "sgarbi vs mughini", ["jingle", "sgarbi"]),
			new Sound("jingle/si-chiavano-tutto.mp3", "si chiavano tutto", ["jingle", "conte dolfin"]),
			new Sound("jingle/six-one.mp3", "six one", ["jingle"]),
			new Sound("jingle/soldi-feat-brasiliano.mp3", "soldi - ft. brasiliano", ["jingle", "brasile"]),
			new Sound("jingle/tefaf.mp3", "tefaf", ["jingle"]),
			new Sound("jingle/trasmissione-della-minchia.mp3", "trasmissione della minchia", ["jingle"]),
			new Sound("jingle/tu-le-offendi.mp3", "tu le offendi", ["jingle", "sgarbi"])
		];		

		repo = new SoundsRepository(MainSounds);
		board = new Board(document.getElementById("crux"), repo);
		header = new HeaderManager(repo, 
			document.getElementById("btn-stop"), 
			document.getElementById("btn-font"), 
			document.getElementById("btn-all"), 
			document.getElementById("btn-jingles"), 
			document.getElementById("btn-play"),
			document.getElementById("btn-crux"));

		CreateAllSoundsBoard();
	}

	function CreateJinglesBoard() {
		var jingles = MainSounds.filter( (sound) => {
			return sound.tags.includes("jingle");
		});

		board.Replace(jingles);
	}

	function CreateCruxBoard() {
		var cruxSounds = MainSounds.filter( (sound) => {
			return sound.tags.includes("crux");
		});

		board.Replace(cruxSounds);
	}

	function CreateAllSoundsBoard() {
		board.Replace(MainSounds);
	}
	
	function shuffle(array) {
		for(let i = array.length - 1; i > 0; i--){
			const j = Math.floor(Math.random() * array.length)
			const temp = array[i]
			array[i] = array[j]
			array[j] = temp
		}
		return array;
	}

	class HeaderManager {
		constructor(soundRepo, stopBtn, fontBtn, filterAllBtn, filterJinglesBtn, playBtn, cruxBtn) {
			this.soundRepo = soundRepo;
			this.board = board;
			this.sizeTurnBig = true;
			this.playlistGoing = false;
			this.stopBtn = stopBtn;
			this.fontBtn = fontBtn;
			this.filterAllBtn = filterAllBtn;
			this.filterJinglesBtn = filterJinglesBtn;
			this.playBtn = playBtn;
			this.cruxBtn = cruxBtn;

			stopBtn.onclick = () => { this.StopAll(); this.StopPlaylist(); };
			this.playBtn.onclick = () => { this.StartPlaylist(); };
			this.fontBtn.onclick = () => { this.FlipSize(); };
			this.filterAllBtn.onclick = CreateAllSoundsBoard;
			this.filterJinglesBtn.onclick = CreateJinglesBoard;
			this.cruxBtn.onclick = CreateCruxBoard;
		}

		StopAll() {
			repo.StopAll();
		}

		FlipSize() {					
			var sizeProp = this.sizeTurnBig ? "xx-large" : "";
			this.fontBtn.innerHTML = this.sizeTurnBig ? "‚ûñ Piccolo" : "‚ûï Grande";

			this.soundRepo.ForEach((sound, audio, button) => {
				button.style.fontSize = sizeProp;		
			});
					
			this.sizeTurnBig = !this.sizeTurnBig;
		}

		StopPlaylist() {
			this.playlistGoing = false;
			repo.UbsubscribeToAudioEnded("playlist");
		}

		StartPlaylist() {
			this.StopAll();
			if (this.playlistGoing) {
				this.StopPlaylist();			
			}

			var sounds = shuffle(board.AvailableSounds());
			var idx = 0;
			repo.SubscribeToAudioEnded( "playlist", (sound, audio) => {			
				if (this.playlistGoing && sound.resource == sounds[idx]) {
					if (idx == sounds.length)
					{
						sounds = shuffle(board.AvailableSounds());
						idx = 0;
					}
					else
					{
						idx += 1;
					}
					repo.Play(sounds[idx]);
				}
			});
			this.playlistGoing = true;
			repo.Play(sounds[idx]);
		}
	}
</script>

<h2>Crux Soundboard</h2></head>
<br/>

<div id="crux-header" class="grid-header">
<button class="btnStop" id="btn-stop">üõë Ferma tutto</button>
<button class="btnAll" id="btn-play">‚ñ∂Ô∏è Playlist casuale</button>
<button class="btnAll" id="btn-font">‚ûï Grande</button>
<button class="btnAll" id="btn-all">Tutti</button>
<button class="btnAll" id="btn-crux">Crux</button>
<button class="btnAll" id="btn-jingles">Jingles</button>
<br/>
</div>

<div id="crux" class="grid-container">
</div>

<div class="footer">Viva la libert√† d'espressione</div>

</body>
</html>
